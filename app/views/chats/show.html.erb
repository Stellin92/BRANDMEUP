<%= turbo_frame_tag "inbox" do %>
  <div data-controller="inbox-opener"></div>
  <%= turbo_stream_from @chat %>

  <div class="inbox-panel">
    <div class="inbox-header">
      <%= link_to "← All", user_chats_path(current_user), data: { turbo_frame: "inbox" }, class: "inbox-back" %>
      <div class="inbox-title">
        <% other = @chat.other_user(current_user) %>
        <%= other.respond_to?(:username) ? other.username : "Chat" %>
      </div>
    </div>

    <div id="<%= dom_id(@chat, :messages) %>"
         class="inbox-messages"
         data-controller="auto-scroll">
      <%= render @messages %>
    </div>

    <div class="inbox-composer">
      <%= form_with url: user_chat_messages_path(current_user, @chat),
                    method: :post,
                    data: { turbo_frame: "inbox" } do %>
        <div class="composer-row">
          <textarea name="content" class="form-control" rows="2" placeholder="Write a message..." required></textarea>
          <button class="btn btn-flat ms-2" type="submit">Send</button>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
